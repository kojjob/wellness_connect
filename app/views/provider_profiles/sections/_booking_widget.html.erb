<div id="booking" class="bg-white rounded-2xl shadow-lg p-6 scroll-mt-24">
  <h3 class="text-2xl font-bold text-gray-900 mb-4 flex items-center">
    <svg class="w-6 h-6 mr-2 text-teal-600" fill="currentColor" viewBox="0 0 24 24">
      <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
    </svg>
    Book Appointment
  </h3>

  <!-- Consultation Rate -->
  <div class="bg-gradient-to-br from-teal-600 to-gray-700 rounded-xl p-6 text-white mb-6">
    <p class="text-sm opacity-90 mb-1">Starting from</p>
    <p class="text-4xl font-bold mb-1">
      $<%= number_with_precision(provider_profile.consultation_rate, precision: 0) %>
    </p>
    <p class="text-sm opacity-90">per session</p>
  </div>

  <!-- Available Slots -->
  <% available_slots = provider_profile.availabilities.where(is_booked: false).where("start_time >= ?", Time.current).order(start_time: :asc).limit(5) %>

  <% if available_slots.any? %>
    <div class="mb-6">
      <h4 class="font-semibold text-gray-900 mb-3 flex items-center">
        <svg class="w-5 h-5 mr-2 text-green-500" fill="currentColor" viewBox="0 0 24 24">
          <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
        </svg>
        Next Available Slots
      </h4>
      <div class="space-y-2">
        <% available_slots.each do |availability| %>
          <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
            <div class="flex-1">
              <p class="font-medium text-gray-900 text-sm">
                <%= availability.start_time.strftime("%b %d") %>
              </p>
              <p class="text-xs text-gray-600">
                <%= availability.start_time.strftime("%I:%M %p") %>
              </p>
            </div>
            <% if user_signed_in? && current_user.patient? %>
              <%= link_to new_appointment_path(availability_id: availability.id),
                  class: "px-3 py-1 bg-teal-600 text-white text-xs rounded-lg hover:bg-teal-700 transition" do %>
                Book
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- View All Availability Button -->
    <% if user_signed_in? && current_user.patient? %>
      <button type="button"
          data-action="click->availability-calendar#openModal"
          class="block w-full text-center px-6 py-3 bg-teal-600 text-white rounded-lg font-semibold hover:bg-teal-700 transition shadow-md mb-4">
        <span class="inline-flex items-center justify-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
          </svg>
          View All Availability
        </span>
      </button>
    <% elsif !user_signed_in? %>
      <%= link_to new_user_session_path,
          class: "block w-full text-center px-6 py-3 bg-teal-600 text-white rounded-lg font-semibold hover:bg-teal-700 transition shadow-md mb-4" do %>
        <span class="inline-flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
          </svg>
          Sign In to Book
        </span>
      <% end %>
    <% end %>
  <% else %>
    <div class="text-center py-6 mb-4">
      <svg class="w-16 h-16 mx-auto text-gray-300 mb-3" fill="currentColor" viewBox="0 0 24 24">
        <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
      </svg>
      <p class="text-gray-600 text-sm">No available slots at this time</p>
      <p class="text-gray-500 text-xs mt-1">Check back soon</p>
    </div>
  <% end %>

  <!-- Contact Options -->
  <div class="border-t border-gray-200 pt-4">
    <p class="text-sm text-gray-600 mb-3">Have questions?</p>
    <button class="w-full px-4 py-2 bg-white border-2 border-teal-600 text-teal-600 rounded-lg font-semibold hover:bg-teal-50 transition">
      <span class="inline-flex items-center">
        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
          <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
        </svg>
        Send Message
      </span>
    </button>
  </div>
</div>
