<section id="services" class="bg-white rounded-2xl shadow-lg p-8">
  <h2 class="text-3xl font-bold text-gray-900 mb-2 flex items-center">
    <svg class="w-8 h-8 mr-3 text-teal-600" fill="currentColor" viewBox="0 0 24 24">
      <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
    </svg>
    Service Packages
  </h2>
  <p class="text-gray-600 mb-8">Choose the package that best fits your needs</p>

  <% if @provider_profile.services.where(is_active: true).any? %>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <% @provider_profile.services.where(is_active: true).limit(3).each_with_index do |service, index| %>
        <div class="border-2 <%= index == 1 ? 'border-teal-600 shadow-xl scale-105 relative' : 'border-gray-200' %> rounded-xl p-6 hover:shadow-2xl transition-all duration-300 flex flex-col">
          <% if index == 1 %>
            <div class="absolute -top-3 left-1/2 transform -translate-x-1/2">
              <span class="bg-gradient-to-r from-teal-600 to-gray-700 text-white px-4 py-1 rounded-full text-sm font-semibold shadow-lg">
                Most Popular
              </span>
            </div>
          <% end %>

          <!-- Package Header -->
          <div class="text-center mb-6">
            <h3 class="text-2xl font-bold text-gray-900 mb-3"><%= service.name %></h3>
            <div class="mb-2">
              <span class="text-5xl font-bold text-teal-600">
                $<%= number_with_precision(service.price, precision: 0) %>
              </span>
            </div>
            <p class="text-gray-600 text-sm flex items-center justify-center gap-1">
              <svg class="w-4 h-4 text-gray-500" fill="currentColor" viewBox="0 0 24 24">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
              </svg>
              <%= service.duration_minutes %> minutes session
            </p>
          </div>

          <!-- Package Description -->
          <div class="mb-6 flex-grow">
            <p class="text-gray-700 text-sm leading-relaxed"><%= service.description %></p>
          </div>

          <!-- Package Features -->
          <div class="space-y-3 mb-6">
            <div class="flex items-start gap-2">
              <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
              </svg>
              <span class="text-sm text-gray-700"><%= service.duration_minutes %> minute consultation</span>
            </div>
            <div class="flex items-start gap-2">
              <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
              </svg>
              <span class="text-sm text-gray-700">Video or in-person session</span>
            </div>
            <div class="flex items-start gap-2">
              <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
              </svg>
              <span class="text-sm text-gray-700">Follow-up notes included</span>
            </div>
            <div class="flex items-start gap-2">
              <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
              </svg>
              <span class="text-sm text-gray-700">Secure & confidential</span>
            </div>
          </div>

          <!-- CTA Button -->
          <% if user_signed_in? && current_user.patient? %>
            <%= link_to new_appointment_path(service_id: service.id),
                class: "block w-full text-center px-6 py-3 #{index == 1 ? 'bg-gradient-to-r from-teal-600 to-gray-700 hover:from-teal-700 hover:to-gray-800' : 'bg-gray-900 hover:bg-gray-800'} text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5",
                data: { turbo: false } do %>
              <span class="flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                </svg>
                Book Appointment
              </span>
            <% end %>
          <% else %>
            <%= link_to new_user_session_path,
                class: "block w-full text-center px-6 py-3 #{index == 1 ? 'bg-gradient-to-r from-teal-600 to-gray-700 hover:from-teal-700 hover:to-gray-800' : 'bg-gray-900 hover:bg-gray-800'} text-white rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5" do %>
              <span class="flex items-center justify-center gap-2">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                </svg>
                Sign In to Book
              </span>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Additional Services (if more than 3) -->
    <% if @provider_profile.services.where(is_active: true).count > 3 %>
      <div class="border-t border-gray-200 pt-8">
        <h3 class="text-xl font-bold text-gray-900 mb-4">Additional Services</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <% @provider_profile.services.where(is_active: true).offset(3).each do |service| %>
            <div class="flex items-start gap-4 p-4 bg-gray-50 rounded-lg border border-gray-200 hover:border-teal-300 hover:shadow-md transition">
              <div class="flex-shrink-0 w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center">
                <svg class="w-6 h-6 text-teal-600" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                </svg>
              </div>
              <div class="flex-grow">
                <h4 class="font-semibold text-gray-900 mb-1"><%= service.name %></h4>
                <p class="text-sm text-gray-600 mb-2"><%= truncate(service.description, length: 100) %></p>
                <div class="flex items-center justify-between">
                  <span class="text-lg font-bold text-teal-600">$<%= number_with_precision(service.price, precision: 0) %></span>
                  <span class="text-sm text-gray-500"><%= service.duration_minutes %> min</span>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

  <% else %>
    <!-- Empty State -->
    <div class="text-center py-16">
      <svg class="w-24 h-24 mx-auto text-gray-300 mb-4" fill="currentColor" viewBox="0 0 24 24">
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
      </svg>
      <h3 class="text-xl font-semibold text-gray-600 mb-2">No Services Available</h3>
      <p class="text-gray-500">This provider hasn't added any services yet.</p>
    </div>
  <% end %>
</section>
