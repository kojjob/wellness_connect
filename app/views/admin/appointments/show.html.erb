<% content_for :admin_page_title, "Appointment Details" %>

<!-- Back Button -->
<div class="mb-6">
  <%= link_to admin_appointments_path, class: "inline-flex items-center text-gray-600 hover:text-gray-900" do %>
    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
    </svg>
    Back to Appointments
  <% end %>
</div>

<!-- Appointment Header -->
<div class="bg-white rounded-lg shadow overflow-hidden mb-6">
  <div class="px-6 py-4 bg-gradient-to-r from-blue-500 to-indigo-600">
    <div class="flex items-center justify-between">
      <div class="text-white">
        <h2 class="text-3xl font-bold">Appointment #<%= @appointment.id %></h2>
        <p class="text-lg text-blue-100 mt-1"><%= @appointment.service.name %></p>
      </div>
      <div>
        <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium
          <%= case @appointment.status
              when 'scheduled' then 'bg-white text-blue-700'
              when 'completed' then 'bg-white text-green-700'
              when 'cancelled_by_patient', 'cancelled_by_provider' then 'bg-white text-red-700'
              when 'no_show' then 'bg-white text-gray-700'
              else 'bg-white text-gray-700'
              end %>">
          <%= @appointment.status.humanize %>
        </span>
      </div>
    </div>
  </div>

  <!-- Appointment Details -->
  <div class="px-6 py-6 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Appointment Information</h3>
    <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
      <div>
        <dt class="text-sm font-medium text-gray-500">Date</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @appointment.start_time.strftime("%A, %B %d, %Y") %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Time</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @appointment.start_time.strftime("%I:%M %p") %> - <%= @appointment.end_time.strftime("%I:%M %p") %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Duration</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @appointment.service.duration_minutes %> minutes</dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Service Price</dt>
        <dd class="mt-1 text-sm text-gray-900">$<%= number_with_precision(@appointment.service.price, precision: 2) %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Created At</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @appointment.created_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Last Updated</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @appointment.updated_at.strftime("%B %d, %Y at %I:%M %p") %></dd>
      </div>
    </dl>
  </div>

  <!-- Patient Information -->
  <div class="px-6 py-6 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Patient Information</h3>
    <div class="flex items-start">
      <div class="w-16 h-16 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-2xl font-bold mr-4">
        <%= @appointment.patient.first_name.first.upcase %>
      </div>
      <div class="flex-1">
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500">Full Name</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @appointment.patient.full_name %></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Email</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @appointment.patient.email %></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Role</dt>
            <dd class="mt-1 text-sm text-gray-900"><span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"><%= @appointment.patient.role.capitalize %></span></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">View User</dt>
            <dd class="mt-1 text-sm">
              <%= link_to "View Patient Profile", admin_user_path(@appointment.patient), class: "text-indigo-600 hover:text-indigo-900" %>
            </dd>
          </div>
        </dl>
      </div>
    </div>
  </div>

  <!-- Provider Information -->
  <div class="px-6 py-6 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Provider Information</h3>
    <div class="flex items-start">
      <div class="w-16 h-16 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center text-2xl font-bold mr-4">
        <%= @appointment.provider.first_name.first.upcase %>
      </div>
      <div class="flex-1">
        <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
          <div>
            <dt class="text-sm font-medium text-gray-500">Full Name</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @appointment.provider.full_name %></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Email</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @appointment.provider.email %></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">Specialty</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @appointment.provider.provider_profile&.specialty || "Not specified" %></dd>
          </div>
          <div>
            <dt class="text-sm font-medium text-gray-500">View Provider</dt>
            <dd class="mt-1 text-sm">
              <%= link_to "View Provider Profile", admin_provider_profile_path(@appointment.provider.provider_profile), class: "text-indigo-600 hover:text-indigo-900" %>
            </dd>
          </div>
        </dl>
      </div>
    </div>
  </div>

  <!-- Service Details -->
  <div class="px-6 py-6 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Service Details</h3>
    <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
      <div>
        <dt class="text-sm font-medium text-gray-500">Service Name</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @appointment.service.name %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-gray-500">Price</dt>
        <dd class="mt-1 text-sm text-gray-900">$<%= number_with_precision(@appointment.service.price, precision: 2) %></dd>
      </div>
      <div class="md:col-span-2">
        <dt class="text-sm font-medium text-gray-500">Description</dt>
        <dd class="mt-1 text-sm text-gray-900"><%= @appointment.service.description %></dd>
      </div>
    </dl>
  </div>

  <!-- Payment Information -->
  <div class="px-6 py-6 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Payment Information</h3>
    <% if @payment %>
      <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
        <div>
          <dt class="text-sm font-medium text-gray-500">Payment Status</dt>
          <dd class="mt-1 text-sm">
            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
              <%= case @payment.status
                  when 'succeeded' then 'bg-green-100 text-green-800'
                  when 'pending' then 'bg-yellow-100 text-yellow-800'
                  when 'failed' then 'bg-red-100 text-red-800'
                  else 'bg-gray-100 text-gray-800'
                  end %>">
              <%= @payment.status.humanize %>
            </span>
          </dd>
        </div>
        <div>
          <dt class="text-sm font-medium text-gray-500">Amount</dt>
          <dd class="mt-1 text-sm text-gray-900">$<%= number_with_precision(@payment.amount, precision: 2) %> <%= @payment.currency.upcase %></dd>
        </div>
        <div>
          <dt class="text-sm font-medium text-gray-500">Stripe Payment Intent ID</dt>
          <dd class="mt-1 text-sm text-gray-900 font-mono text-xs"><%= @payment.stripe_payment_intent_id || "N/A" %></dd>
        </div>
        <div>
          <dt class="text-sm font-medium text-gray-500">Paid At</dt>
          <dd class="mt-1 text-sm text-gray-900"><%= @payment.paid_at ? @payment.paid_at.strftime("%B %d, %Y at %I:%M %p") : "Not paid yet" %></dd>
        </div>
      </dl>
    <% else %>
      <p class="text-sm text-gray-500">No payment information available</p>
    <% end %>
  </div>

  <!-- Cancellation Information (if applicable) -->
  <% if @appointment.status.start_with?('cancelled_') %>
    <div class="px-6 py-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Cancellation Information</h3>
      <dl class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4">
        <div>
          <dt class="text-sm font-medium text-gray-500">Cancelled By</dt>
          <dd class="mt-1 text-sm text-gray-900">
            <%= @appointment.status == 'cancelled_by_patient' ? 'Patient' : 'Provider' %>
          </dd>
        </div>
        <% if @appointment.cancellation_reason.present? %>
          <div class="md:col-span-2">
            <dt class="text-sm font-medium text-gray-500">Cancellation Reason</dt>
            <dd class="mt-1 text-sm text-gray-900"><%= @appointment.cancellation_reason %></dd>
          </div>
        <% end %>
      </dl>
    </div>
  <% end %>
</div>
