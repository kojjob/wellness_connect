<%
# Set defaults using local_assigns
size = local_assigns.fetch(:size, :medium)
shape = local_assigns.fetch(:shape, :rounded)
show_ring = local_assigns.fetch(:show_ring, false)
additional_classes = local_assigns.fetch(:additional_classes, "")
show_status = local_assigns.fetch(:show_status, false)

# Size configurations
size_config = case size
              when :small
                { container: "h-8 w-8", text: "text-xs", ring: "ring-1" }
              when :medium
                { container: "h-12 w-12", text: "text-sm", ring: "ring-2" }
              when :large
                { container: "h-16 w-16", text: "text-lg", ring: "ring-2" }
              when :xlarge
                { container: "h-24 w-24", text: "text-2xl", ring: "ring-4" }
              else
                { container: "h-12 w-12", text: "text-sm", ring: "ring-2" }
              end

# Shape classes
shape_class = shape == :circle ? "rounded-full" : "rounded-xl"

# Ring classes
ring_class = show_ring ? "#{size_config[:ring]} ring-white" : ""

# Build container classes
container_classes = [
  size_config[:container],
  shape_class,
  ring_class,
  "flex-shrink-0 relative overflow-hidden",
  additional_classes
].compact.reject(&:blank?).join(" ")
%><div class="<%= container_classes %>">
  <% if user.avatar.attached? %>
    <%
      # Get the appropriate variant size
      variant_dimensions = case size
                          when :small then [64, 64]
                          when :medium then [96, 96]
                          when :large then [128, 128]
                          when :xlarge then [192, 192]
                          else [96, 96]
                          end
    %>
    <%= image_tag user.avatar.variant(resize_to_fill: variant_dimensions),
          alt: "#{user.full_name}'s avatar",
          class: "h-full w-full object-cover",
          loading: "lazy" %>
  <% else %>
    <div class="h-full w-full bg-gradient-to-br <%= user.avatar_gradient_classes %> flex items-center justify-center shadow-lg">
      <span class="<%= size_config[:text] %> font-bold text-white">
        <%= user.initials %>
      </span>
    </div>
  <% end %>
  <% if show_status %>
    <span class="absolute bottom-0 right-0 block <%= size == :small ? 'h-2 w-2' : 'h-3 w-3' %> rounded-full bg-green-400 ring-2 ring-white"></span>
  <% end %>
</div>
