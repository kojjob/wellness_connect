<%#
  Date Range Picker Component

  Usage:
    <%= render 'shared/date_range_picker',
               form_path: dashboard_path,
               auto_submit: true,
               start_date: params[:start_date],
               end_date: params[:end_date] %>

  Parameters:
    - form_path: The path to submit the form to (required)
    - auto_submit: Whether to auto-submit on date change (default: true)
    - start_date: Initial start date value (optional)
    - end_date: Initial end date value (optional)
    - method: HTTP method for form (default: :get)
%>

<%
  auto_submit ||= true
  method ||= :get
  start_date ||= params[:start_date]
  end_date ||= params[:end_date]
%>

<div class="bg-white rounded-lg shadow-md p-6 mb-6"
     data-controller="date-range"
     data-date-range-auto-submit-value="<%= auto_submit %>">

  <div class="mb-4">
    <h3 class="text-lg font-semibold text-gray-900 mb-2">ðŸ“… Date Range Filter</h3>
    <p class="text-sm text-gray-600">Select a date range to filter analytics data</p>
  </div>

  <%= form_with url: form_path, method: method,
                data: { date_range_target: "form" },
                class: "space-y-4" do |f| %>

    <!-- Preset Buttons -->
    <div class="flex flex-wrap gap-2 mb-4">
      <button type="button"
              data-date-range-target="preset"
              data-preset="today"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        Today
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="yesterday"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        Yesterday
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="last_7_days"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        Last 7 Days
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="last_30_days"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-teal-600 text-white hover:bg-teal-700 transition">
        Last 30 Days
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="last_90_days"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        Last 90 Days
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="this_month"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        This Month
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="last_month"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        Last Month
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="this_year"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        This Year
      </button>

      <button type="button"
              data-date-range-target="preset"
              data-preset="all_time"
              data-action="click->date-range#applyPreset"
              class="px-3 py-1.5 rounded-md text-sm font-medium bg-gray-100 text-gray-700 hover:bg-gray-200 transition">
        All Time
      </button>
    </div>

    <!-- Custom Date Inputs -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <%= f.label :start_date, "Start Date", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :start_date,
                         value: start_date,
                         data: { date_range_target: "startDate", action: "change->date-range#dateChanged" },
                         class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500" %>
      </div>

      <div>
        <%= f.label :end_date, "End Date", class: "block text-sm font-medium text-gray-700 mb-1" %>
        <%= f.date_field :end_date,
                         value: end_date,
                         data: { date_range_target: "endDate", action: "change->date-range#dateChanged" },
                         class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500" %>
      </div>
    </div>

    <!-- Action Buttons (only shown if auto_submit is false) -->
    <% unless auto_submit %>
      <div class="flex gap-3 mt-4">
        <%= f.submit "Apply Filter",
                     data: { action: "click->date-range#submitForm" },
                     class: "px-6 py-2 bg-teal-600 text-white font-medium rounded-md hover:bg-teal-700 transition focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2" %>

        <button type="button"
                data-action="click->date-range#clearDates"
                class="px-6 py-2 bg-gray-200 text-gray-700 font-medium rounded-md hover:bg-gray-300 transition focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
          Clear Dates
        </button>
      </div>
    <% end %>
  <% end %>

  <!-- Helper Text -->
  <div class="mt-4 text-xs text-gray-500">
    <% if auto_submit %>
      <p>ðŸ’¡ Tip: Analytics will refresh automatically when you select a date range or preset.</p>
    <% else %>
      <p>ðŸ’¡ Tip: Select your date range and click "Apply Filter" to refresh analytics.</p>
    <% end %>
  </div>
</div>
