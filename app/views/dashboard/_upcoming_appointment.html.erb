<%# Upcoming Appointment Card %>
<div class="border border-gray-200 rounded-xl p-5 hover:border-teal-300 hover:shadow-md transition-all duration-200 bg-gradient-to-br from-white to-gray-50">
  <div class="flex items-start gap-4">
    <%# Provider Avatar %>
    <div class="flex-shrink-0">
      <% if appointment.provider.avatar.attached? %>
        <%= image_tag appointment.provider.avatar.variant(resize_to_limit: [64, 64]), 
                      alt: "#{appointment.provider.full_name}",
                      class: "w-16 h-16 rounded-full object-cover ring-2 ring-teal-100",
                      loading: "lazy" %>
      <% else %>
        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center ring-2 ring-teal-100">
          <span class="text-white text-xl font-bold">
            <%= appointment.provider.first_name&.first&.upcase %><%= appointment.provider.last_name&.first&.upcase %>
          </span>
        </div>
      <% end %>
    </div>

    <%# Appointment Details %>
    <div class="flex-1 min-w-0">
      <div class="flex items-start justify-between mb-2">
        <div>
          <h3 class="text-lg font-semibold text-gray-900 mb-1"><%= appointment.service.name %></h3>
          <p class="text-sm text-gray-600">
            with <span class="font-medium text-gray-900"><%= appointment.provider.full_name %></span>
          </p>
        </div>
        <span class="px-3 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full flex-shrink-0">
          Scheduled
        </span>
      </div>

      <%# Date & Time %>
      <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-3">
        <div class="flex items-center">
          <svg class="w-4 h-4 mr-1.5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
          <span class="font-medium"><%= appointment.start_time.in_time_zone(current_user.time_zone || 'UTC').strftime("%B %d, %Y") %></span>
        </div>
        <div class="flex items-center">
          <svg class="w-4 h-4 mr-1.5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          <span class="font-medium"><%= appointment.start_time.in_time_zone(current_user.time_zone || 'UTC').strftime("%I:%M %p %Z") %></span>
        </div>
        <div class="flex items-center">
          <svg class="w-4 h-4 mr-1.5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
          <span><%= appointment.service.duration_minutes %> min</span>
        </div>
      </div>

      <%# Payment Info %>
      <% if appointment.payment.present? %>
        <div class="flex items-center text-sm mb-4">
          <svg class="w-4 h-4 mr-1.5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
          </svg>
          <span class="font-semibold text-gray-900"><%= number_to_currency(appointment.payment.amount, unit: "$") %></span>
          <span class="mx-2">â€¢</span>
          <span class="px-2 py-0.5 rounded-full text-xs font-medium
            <%= case appointment.payment.status
                when 'succeeded' then 'bg-green-100 text-green-800'
                when 'pending' then 'bg-yellow-100 text-yellow-800'
                when 'failed' then 'bg-red-100 text-red-800'
                else 'bg-gray-100 text-gray-800'
                end %>">
            <%= appointment.payment.status.titleize %>
          </span>
        </div>
      <% end %>

      <%# Action Buttons %>
      <div class="flex flex-wrap gap-2">
        <% if appointment.video_session_id.present? %>
          <%= link_to "#", class: "inline-flex items-center px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white text-sm font-medium rounded-lg shadow-sm hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:ring-offset-2" do %>
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            Join Video Call
          <% end %>
        <% end %>

        <%= button_to cancel_appointment_path(appointment), 
                      method: :patch,
                      form: { data: { turbo_confirm: "Are you sure you want to cancel this appointment?" } },
                      class: "inline-flex items-center px-4 py-2 bg-white hover:bg-gray-50 text-gray-700 text-sm font-medium rounded-lg border border-gray-300 shadow-sm hover:shadow-md transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2" do %>
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          Cancel
        <% end %>
      </div>

      <%# Countdown Timer (if appointment is within 24 hours) %>
      <% time_until = appointment.start_time - Time.current %>
      <% if time_until > 0 && time_until < 24.hours %>
        <div class="mt-3 pt-3 border-t border-gray-200">
          <div class="flex items-center text-sm">
            <svg class="w-4 h-4 mr-1.5 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
            <span class="text-amber-700 font-medium">
              Starts in <%= distance_of_time_in_words(Time.current, appointment.start_time) %>
            </span>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

